---
title: 'Hengst Chapter 2: B)'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 2019 and 2020 temperature ranges

Show code and file header information for 2019. Provide an equivalent and more succinct report for 2020. First loading the data.

```{r, warning=FALSE}
library(magrittr)
alltemps19 <- readr::read_csv("./trapview_temps_degf_y19.csv")
alltemps19
```

### 2019 <61F: Percent nights by month

Table of the proportion of nights per month in which the temperature fell into the upper end of the range identified by Landolt and Curtis as influencing mating.

``` {r, warning=FALSE}
alltemps19 %>%
  dplyr::mutate(mnth = lubridate::month(Date_time, label = TRUE, abbr = TRUE),
                day_of_mnth = lubridate::mday(Date_time)) %>% 
  dplyr::group_by(site, mnth, day_of_mnth) %>% 
  dplyr::summarise(degf_lo = min(degf_lo)) %>% 
  dplyr::mutate(lt66 = ifelse(degf_lo < 66,1,0),
         lt52 = ifelse(degf_lo <= 52,1,0)) %>% 
  dplyr::filter(!is.na(degf_lo)) %>% 
  dplyr::group_by(site,mnth) %>% 
  dplyr::summarise(lt66 = sum(lt66),
            lt52 = sum(lt52),
            nObs = dplyr::n(),
            pct_lt66 = 100*lt66/nObs,
            pct_lt52 = 100*lt52/nObs) %>% 
  dplyr::select(site,mnth,pct_lt66) %>% 
  tidyr::pivot_wider(id_cols = site, 
                     names_from = mnth, 
                     values_from = pct_lt66,
                     values_fill = 0) %>% 
  dplyr::select(site,May,Jun,Jul,Aug,Sep,Oct,Nov)  %>%
  knitr::kable(., "latex")
```

## 2020 <61F: Percent nights by month

Again load data and head() two lines. Note that all units are at the same "site" as defined for 2019, so site in 2020 distinguishes which row the trap was in.

```{r, echo=FALSE, warning=FALSE}
alltemps20 <- readr::read_csv("./trapview_temps_degf_y20.csv")
head(alltemps20,2)
```


``` {r, warning=FALSE}
alltemps20 %>%
  dplyr::mutate(mnth = lubridate::month(Date_time, label = TRUE, abbr = TRUE),
                day_of_mnth = lubridate::mday(Date_time)) %>% 
  dplyr::group_by(site, mnth, day_of_mnth) %>% 
  dplyr::summarise(degf_lo = min(degf_lo)) %>% 
  dplyr::mutate(lt66 = ifelse(degf_lo < 66,1,0),
                lt52 = ifelse(degf_lo <= 52,1,0)) %>% 
  dplyr::filter(!is.na(degf_lo)) %>% 
  dplyr::group_by(site,mnth) %>% 
  dplyr::summarise(lt66 = sum(lt66),
            lt52 = sum(lt52),
            nObs = dplyr::n(),
            pct_lt66 = 100*lt66/nObs,
            pct_lt52 = 100*lt52/nObs) %>% 
  dplyr::select(site,mnth,pct_lt52) %>% 
  tidyr::pivot_wider(id_cols = site, 
                     names_from = mnth, 
                     values_from = pct_lt52,
                     values_fill = 0) %>%
  dplyr::select(site,Feb,Mar,May,Jun,Jul,Aug,Sep) %>% 
  knitr::kable(., "latex")
```
